KISSY.add("pcm/pages/header/index",function(t,e,a,n){function i(t){this.config=t,this.obj={},this.init()}var c=t.all,o=c("#cityName"),r=c(".M-cityWrap"),s=c(".M-cityList"),l=new e(window.location.href),d=l.getQuery();return t.augment(i,{_ajax:function(t,e,a){n({dataType:"jsonp",url:t,data:e,jsonp:"jsoncallback",async:!1,success:function(t){a(t)},error:function(){}})},_request:function(e){var a="",n=this,i="/";"true"==c("body").attr("data-changeCityInPage")&&(i=l.path.toString()),n._titleClick(i);for(var o in e){var r="";t.each(e[o],function(t){var e=d.set("city",t.cityCode).toString();r+="<a data-id="+t.cityCode+" href="+i+"?"+e+">"+t.regionName+"</a>"}),a+="<li><label>"+o+"</label>"+r+"</li>"}s.html("<ul>"+a+"</ul>"),n._renderClallback()},_titleClick:function(e){var a=r.children(".cityList").children(".cityBox").children(".cityTitle").children("a");t.each(a,function(t){var a=d.set("city",c(t).attr("data-id")).toString();c(t).attr("href",e+"?"+a)})},_renderClallback:function(){var e=this;t.each(s.all("a"),function(t){e.obj[c(t).attr("data-id")]=c(t).offset().top});var a=o.all(".name").attr("data-id");o.all(".name").removeClass("current");var n=r.all("a[data-id]");t.each(n,function(t){c(t).attr("data-id")==a&&c(t).addClass("current")})},_requsetCity:function(){var t=this,a=window.location.href,n="",i=new e(a);n=i.getQuery().get("city")?i.getQuery().get("city"):i.path.replace(/\//g,""),t._ajax("/cityAction.json?action=cityAction&n_s=new&event_submit_doLocate=true",{city:n},function(t){o.one(".name").text(t.returnValue.name),o.one(".name").attr("data-id",t.returnValue.city)})},_setHighLight:function(t){c("#J_Nav_"+t).addClass("current")},_search:function(e){var a=this,n=e.length,i=[],o=s.offset().top;s.all("a").removeClass("selected"),t.each(s.all("a"),function(t){if(-1!=c(t).text().indexOf(e)){i.push(c(t).attr("data-id"));var a=c(t).text().indexOf(e),o=c(t).text();c(t).addClass("selected"),c(t).html(o.slice(0,a)+"<span>"+o.slice(a,a+n)+"</span>"+o.slice(a+n))}}),s.scrollTop(a.obj[i[0]]-o)},_stopMouseWheelBubble:function(t,e){t&&c(t).on("mousewheel",function(t){var a=c(this).height();"120"==t.wheelDelta||"-3"==t.detail?0==c(this).scrollTop()&&t.halt():c(this).scrollTop()===e-a})},init:function(){var t,e=this,a=!1;this._requsetCity(),r.on("mouseenter",function(){var i=this;t=setTimeout(function(){c(i).addClass("cityWrap_hover"),a||n({dataType:"jsonp",url:"/cityAction.json?action=cityAction&n_s=new&event_submit_doGetAllRegion=true",data:{activityId:d.get("activityId")},jsonp:"jsoncallback",success:function(t){e._request(t.returnValue),a=!0,e._stopMouseWheelBubble(".M-cityList",s.children("ul").height())}})},200)}),r.on("mouseleave",function(){clearInterval(t),c(this).removeClass("cityWrap_hover")}),r.delegate("click",".J_citySearch_btn",function(t){var a=c(t.currentTarget).parent().all("input").val();e._search(a)}),r.all(".citySearch input").on("keydown",function(){13==event.keyCode&&c(".J_citySearch_btn").fire("click")})}}),i},{attach:!1,requires:["uri","node","io"]}),function(){var t=document.getElementsByTagName("body")[0],e=document.createElement("div");e.classList.add("J_smartBanner"),e.classList.add("banner-container");var a=document.createElement("a");a.classList.add("J_pupil"),a.classList.add("pupil-container");var n=document.createElement("div");n.classList.add("J_sBanner"),n.classList.add("sBanner-container"),e.appendChild(a),e.appendChild(n);var i,c=document.documentMode,o=!!window.ActiveXObject,r=o&&!window.XMLHttpRequest,s=o&&!r&&!c||7==c,l=o&&8==c;i=r||s||l;var d=document.createElement("img"),u="//gw.alicdn.com/tfs/TB1NuagqL1TBuNjy0FjXXajyXXa-190-150.png",p="//gw.alicdn.com/tfs/TB1fV4hqFGWBuNjy0FbXXb4sXXa-190-150.png";d.src=i?u:p,a.appendChild(d);var h=document.createElement("img");h.src=i?"//gw.alicdn.com/tfs/TB1dCxHPhnaK1RjSZFBXXcW7VXa-1920-219.png":"//gw.alicdn.com/tfs/TB1C5piPmzqK1RjSZFpXXakSXXa-1920-219.png",n.appendChild(h);var m=document.createElement("a");m.classList.add("J_closeIcon"),m.classList.add("close-icon"),n.appendChild(m);var f=document.createElement("a"),v=document.createElement("a");f.classList.add("text-box"),v.classList.add("text-box"),v.classList.add("android-box"),f.innerText="iPhone\u4e0b\u8f7d",f.setAttribute("data-spm-anchor-id","a1z21.3046609.banner.1"),v.innerText="Android\u4e0b\u8f7d",v.setAttribute("data-spm-anchor-id","a1z21.3046609.banner.2"),n.appendChild(f),n.appendChild(v),t.appendChild(e),d.addEventListener("click",function(){a.style.left="-100%",setTimeout(function(){n.style.left="0%"},500)}),m.addEventListener("click",function(){n.style.left="-100%",setTimeout(function(){a.style.left="0%"},500)}),f.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation();var e=t.target.getAttribute("data-spm-anchor-id"),a="https://itunes.apple.com/app/apple-store/id566813949?pt=417711&ct=qrpcsmartb&mt=8&spm"+e;window.location.href=a}),v.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation();var e=t.target.getAttribute("data-spm-anchor-id"),a="https://download.alicdn.com/wireless/movie4android/latest/movie4android_702766.apk?spm="+e;window.location.href=a}),setTimeout(function(){n.style.left="0%"},1e3)}();